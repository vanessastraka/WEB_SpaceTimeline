<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/css/main.css">
    <link rel="stylesheet" href="../styles/css/timeline.css">
    <link rel="icon" type="image/apng" href="../images/favicon.png">
    <meta name="author" content="KLKM">
    <meta name="description" content="Project for ...">
    <title>SpaceTimeline</title>
    <style>.hidden { display: none !important; }</style>
</head>
<body>
<!-- HEADER WITH LOGIN/REGISTER -->
<header>
    <div class="header-container">
        <!-- LINKS: User-Info + Login/Logout -->
        <div class="header-left">
            <!-- Login-Form -->
            <form id="login-form">
                <input id="login-username" name="username" type="text"  placeholder="User"     required />
                <input id="login-password" name="password" type="password" placeholder="Passwort" required />
                <button type="submit">Login</button>
                <span id="login-error" class="hidden"></span>
            </form>
            <!-- Nach Login: Username + Logout -->
            <span id="user-info" class="hidden"></span>
            <button id="logout-btn" class="hidden">Logout</button>
        </div>


        <!-- MITTE: Filter-Panel -->
        <div class="header-center" id="filter-panel">
            <label for="filter-text">Event:</label>
            <select id="filter-text"></select>
            <label for="filter-from">From:</label>
            <input type="date" id="filter-from"/>
            <label for="filter-to">Until:</label>
            <input type="date" id="filter-to"/>
            <button id="filter-go">Start</button>
            <button id="reset-timeline">Reset Timeline</button>
        </div>

        <!-- RECHTS: Hamburger-Menü -->
        <div class="header-right">
            <button id="hamburger-btn" class="hamburger-btn" aria-label="Menü">☰</button>
            <nav id="hamburger-menu" class="hamburger-menu hidden">
                <a href="https://api.nasa.gov/" target="_blank">NASA API Info</a>
                <a href="https://media3.giphy.com/..." target="_blank">FAQ</a>
                <a href="register.html">Registrieren</a>
            </nav>
        </div>
    </div>
</header>


<!-- TIMELINE -->
<main>
    <div id="timeline-container">
        <div id="timeline"></div>
    </div>
</main>

<footer>Copyright © 2025 KLKM</footer>

<!-- INFO PANEL -->
<div id="info-panel">
    <button id="toggle-button">▲ Open</button>
    <div class="info-content">
        <div class="info-box">
            <h3>General Information</h3>
            <p>A solar flare is a sudden, intense burst of radiation from the sun’s surface...</p>
        </div>
        <div class="info-box">
            <h3>Event Information</h3>
            <button id="fav-button" class="hidden">Zu Favoriten</button>
            <a href="http://localhost:3000/fav"><button id="fav-site" class="hidden">Fav Site</button></a>
            <div class="event-box"></div>
        </div>
        <div class="info-box related-image-box">
            <h3>Related Image</h3>
            <img src="https://d.newsweek.com/en/full/2519753/illustration-solar-flare.jpg" alt="Related Image" />
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script>
        // 1) JWT→Username
        function getUsernameFromToken() {
        const t = localStorage.getItem('jwt');
        if (!t) return null;
        try { return JSON.parse(atob(t.split('.')[1])).username; }
        catch { return null; }
    }

        // 2) Login-Funktion
        async function doLogin(u,p){
        const res = await fetch('/api/login',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({username:u,password:p})
    });
        return res.json();
    }

        document.addEventListener('DOMContentLoaded',()=>{
        const form    = document.getElementById('login-form');
        const errSpan = document.getElementById('login-error');
        const userSp  = document.getElementById('user-info');
        const outBtn  = document.getElementById('logout-btn');

        // bereits eingeloggt?
        const name = getUsernameFromToken();
        if(name){
        form.classList.add('hidden');
        userSp.textContent = 'Angemeldet: '+name;
        userSp.classList.remove('hidden');
        outBtn.classList.remove('hidden');
    }

        form.addEventListener('submit', async e=>{
        e.preventDefault();
        errSpan.classList.add('hidden');
        const u = document.getElementById('login-username').value;
        const p = document.getElementById('login-password').value;
        const d = await doLogin(u,p);
        if(d.token){
        localStorage.setItem('jwt',d.token);
        form.classList.add('hidden');
        userSp.textContent = 'Angemeldet: '+u;
        userSp.classList.remove('hidden');
        outBtn.classList.remove('hidden');
    } else {
        const msg = d.error||'Login fehlgeschlagen';
        errSpan.textContent = msg;
        errSpan.classList.remove('hidden');
        if(confirm(msg+'\nKein Konto gefunden - Registrieren?')){
        location.href='register.html';
    }
    }
    });

        outBtn.addEventListener('click',()=>{
        localStorage.removeItem('jwt');
        location.reload();
    });

        // Hamburger
        document.getElementById('hamburger-btn')
        .addEventListener('click',()=>{
        document.getElementById('hamburger-menu')
        .classList.toggle('hidden');
    });
    });
</script>
<script src="../scripts/timeline.js"></script>
<script src="../scripts/app.js"></script>
</body>
</html>
